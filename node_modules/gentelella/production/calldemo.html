<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <!-- Meta, title, CSS, favicons, etc. -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Better Together | </title>

  <!-- Bootstrap -->
  <link href="../vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link href="../vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
  <!-- iCheck -->
  <link href="../vendors/iCheck/skins/flat/green.css" rel="stylesheet">
  <!-- bootstrap-progressbar -->
  <link href="../vendors/bootstrap-progressbar/css/bootstrap-progressbar-3.3.4.min.css" rel="stylesheet">
  <!-- jVectorMap -->
  <link href="css/maps/jquery-jvectormap-2.0.3.css" rel="stylesheet" />

  <!-- Custom Theme Style -->
  <link href="../build/css/custom.min.css" rel="stylesheet">

  <script src="https://d3js.org/d3.v4.min.js"></script>
</head>

<body class="nav-md">
  <div class="container body">
    <div class="main_container">
      <div class="col-md-3 left_col">
        <div class="left_col scroll-view">
          <div class="navbar nav_title" style="border: 0;">
            <a href="index.html" class="site_title"> <span>Better Together</span></a>
          </div>

          <div class="clearfix"></div>

          <!-- menu profile quick info -->
          <div class="profile">
            <div class="profile_pic">
              <img src="images/profile.jpg" alt="..." class="img-circle profile_img">
            </div>
            <div class="profile_info">
              <span>Welcome,</span>
              <h2>Siddharth Subramanian</h2>
            </div>
          </div>
          <!-- /menu profile quick info -->

          <br />

          <!-- sidebar menu -->
          <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
              <div class="menu_section">
                <h3>General</h3>
                <ul class="nav side-menu">
                  <li><a href="homepage.html"><i class="fa fa-home"></i> Home </a></li>
                  <li><a><i class="fa fa-group"></i> Patients <span class="fa fa-chevron-down"></span></a>
                    <ul class="nav child_menu patientsListSidebar"></ul>
                  </li>
                  <li><a href="calldemo.html"><i class="fa fa-phone"></i> Contact Patient</a></li>
                  <li><a href="groupschedule.html"><i class="fa fa-phone"></i> Schedule Group Session</a></li>
                  <li><a><i class="fa fa-gear"></i> Settings</a></li>
                </ul>
              </div>
              <div class="menu_section">
              </div>
            </div>
          <!-- /sidebar menu -->
        </div>
      </div>

      <!-- top navigation -->
      <div class="top_nav">
        <div class="nav_menu">
          <nav class="" role="navigation">
            <div class="nav toggle">
              <a id="menu_toggle"><i class="fa fa-bars"></i></a>
            </div>

            <ul class="nav navbar-nav navbar-right">
              <li class="">
                <a href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                  <img src="images/profile.jpg" alt="">Siddharth Subramanian
                  <span class=" fa fa-angle-down"></span>
                </a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
      <!-- /top navigation -->

      <!-- page content -->
      <div class="right_col" role="main">
        <!-- top tiles -->

        <!-- /top tiles -->


        <br />
        <div class="row">
          <div class="col-md-12 col-lg-12">
            <div class="x_panel">
              <div class="x_title">
                <h2>Call Patient</h2>
                <div class="clearfix"></div>
              </div>
              <div class="x_content">
                <form class="form-horizontal form-label-left">
                  <div class="col-md-12 col-sm-12 col-xs-12">
                    <select id="patient_list" class="select2_single form-control" tabindex="-1" style="height: 62px;  font-size: 25px;">
                            <option></option>
                            <!--<option value="1">Patient1</option>
                            <option value="2">Patient2</option>                            -->
                          </select>
                  </div>

                </form>
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-12 col-lg-12">
            <div class="x_panel">
              <div class="x_content">
                <form class="form-horizontal form-label-left">
                  <div class="col-md-7 col-sm-7 col-xs-7">
                    <textarea id="call_conversation" style="height: 141px; font-size: 25px;
    color: gray;"  class="form-control" name="message"  ></textarea>
                  </div>
                  
                  <div class="col-md-5 col-sm-5 col-xs-5">
                     <button class="btn btn-success btn-lg"><i  class="fa fa-phone-square fa-4" aria-hidden="true" style="font-size: 116px;"></i> </button>   
                    
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>

        <div id="risk_score_data" class="row">
          <div class="col-md-10 col-xs-10  widget widget_tally_box">
            <div class="x_panel fixed_height_390">
              <div class="x_title">
                <h2 id="risk_value">Risk Score :  </h2> 

                <div class="clearfix"></div>
              </div>
              <div class="x_content">
                <canvas width="100px" height="100px" id="myChart"></canvas>


              </div>
            </div>
          </div>
          <div class="col-md-5 col-xs-5 ">
            <div class="x_panel">
              <div class="x_title">
                <h2>Emotion Analysis</h2> 

                <div class="clearfix"></div>
              </div>
              <div id="emotion_content" class="x_content">
                


              </div>
            </div>
          </div>
          <div class="col-md-3 col-xs-3 ">
            <div class="x_panel">
              <div class="x_title">
                <h2>Concepts & Keywords</h2> 

                <div class="clearfix"></div>
              </div>
              <div id="concepts_content" class="x_content">
                <span class="tag"><span>social&nbsp;&nbsp;</span></span>
                <span class="tag"><span>science&nbsp;&nbsp;</span></span>

              </div>
            </div>
          </div>
        </div>


      </div>
      <!-- /page content -->

      <!-- footer content -->
      <footer>
        <div class="pull-right">
          Better Together
        </div>
        <div class="clearfix"></div>
      </footer>
      <!-- /footer content -->
    </div>
  </div>

  <!-- jQuery -->
  <script src="../vendors/jquery/dist/jquery.min.js"></script>
  <!-- Bootstrap -->
  <script src="../vendors/bootstrap/dist/js/bootstrap.min.js"></script>
  <!-- FastClick -->
  <script src="../vendors/fastclick/lib/fastclick.js"></script>
  <!-- NProgress -->
  <script src="../vendors/nprogress/nprogress.js"></script>
  <!-- Chart.js -->
  <script src="../vendors/Chart.js/dist/Chart.min.js"></script>
  <!-- gauge.js -->
  <script src="../vendors/bernii/gauge.js/dist/gauge.min.js"></script>
  <!-- bootstrap-progressbar -->
  <script src="../vendors/bootstrap-progressbar/bootstrap-progressbar.min.js"></script>
  <!-- iCheck -->
  <script src="../vendors/iCheck/icheck.min.js"></script>
  <!-- Skycons -->
  <script src="../vendors/skycons/skycons.js"></script>
  <!-- Flot -->
  <script src="../vendors/Flot/jquery.flot.js"></script>
  <script src="../vendors/Flot/jquery.flot.pie.js"></script>
  <script src="../vendors/Flot/jquery.flot.time.js"></script>
  <script src="../vendors/Flot/jquery.flot.stack.js"></script>
  <script src="../vendors/Flot/jquery.flot.resize.js"></script>
  <!-- Flot plugins -->
  <script src="js/flot/jquery.flot.orderBars.js"></script>
  <script src="js/flot/date.js"></script>
  <script src="js/flot/jquery.flot.spline.js"></script>
  <script src="js/flot/curvedLines.js"></script>
  <!-- jVectorMap -->
  <script src="js/maps/jquery-jvectormap-2.0.3.min.js"></script>
  <!-- bootstrap-daterangepicker -->
  <script src="js/moment/moment.min.js"></script>
  <script src="js/datepicker/daterangepicker.js"></script>

  <!-- Custom Theme Scripts -->
  <script src="../build/js/custom.min.js"></script>

  <!-- Flot -->
  <script>
  var selectedUser ;
  function postCall(){
            console.log('post called');
            

          }

  function getRandomConversation(){
    var rand = Math.floor(Math.random() * (5 - 1)) + 1;
    console.log("random : "+rand);
    var conversations = [
      "Bonding through blood and battle takes the soldier to a whole new level of raw humanism forged through survival and fight or flight defensive mechanisms. The psychology of killing alters the terrain of the mind disabling the rational machinery and enabling the ancient reflexive responsive unconscious.",
      "During times of great turmoil and adversity such as a loved one struggling and succumbing to the ravishing effects of PTSD, this will release devastating effects on the person and sometimes can reap outrageous and deleterious consequences to others.",
      "Imagine knowing something about yourself more than you know anything, and at the same time knowing how unreal it is. This part of you has such a hold on you, that you cannot for the life of yourself feel its grasp until it is too late, then it has you and you are no longer yourself. Imagine a watery consciousness slipping away and thinking who was that? And, you already know the answer, as it dissipates like smoke on the wind. In that moment of realization comes the instantaneous realization of your being, slipping away.",
      "The good general is simply the good company commander in his post-graduate course. The idea that more godlike qualities are required of him and that he above others can achieve miracles through the working of his will is dismissed as idle superstition.",
      "Courage is almost a contradiction in terms. It means a strong desire to live taking the form of readiness to die."
    ]
    return conversations[rand];
  }
      $(document).ready(function() {
        //GET PATIENTS
        $("#risk_score_data").hide();
        
        $.ajax({
         url :  "http://158.85.149.138:8080/getpatients"
        }).done(function(data){
            var selectOptions ="";
            var patients = JSON.parse(data);
            for(var i = 0 ; i < patients.length; i++){
              selectOptions += '<option value="'+patients[i].patientid+'">Patient : '+patients[i].firstname+' '+patients[i].lastname+'</option>'
            }
            $( selectOptions ).appendTo( "#patient_list" );
        });

        
        $( "#patient_list" ).change(function() {
          var conversationText = "";
          console.log( this.value );
          selectedUser = this.value;
          conversationText = getRandomConversation();
          $("#call_conversation").text(conversationText);
          
          if(selectedUser){
                        $.post({
                      url: "http://158.85.149.138:8080/analysistext"    ,
                      data: JSON.stringify({
                        'text' : getRandomConversation(),
                        'patient_id' : selectedUser
                      })
                      

                    }).done(function(data) {
                      $("#risk_score_data").show();
                      var emotion = JSON.parse(data);

                      console.log(emotion);
                      var emotions = emotion.scores.emotion.document.emotion;
                      $("#emotion_content").empty();
                      $("#concepts_content").empty();
                      var conceptContent = "";
                      for(var i=0 ; i < emotion.scores.concepts.length ; i++){
                        conceptContent += '<span class="tag"><span>'+emotion.scores.concepts[i].text+'</span></span>'
                      }
                      $( conceptContent ).appendTo( "#concepts_content" );
                      var htmlEmotions = "<h1>Anger : "+emotions.anger+"<h1>" + "<h1>Disgust : "+emotions.disgust+"<h1>"+"<h1>Fear : "+emotions.fear+"<h1>"+"<h1>Joy : "+emotions.joy+"<h1>"+"<h1>Sadness : "+emotions.sadness+"<h1>"
                      $( htmlEmotions ).appendTo( "#emotion_content" );
                      var risk_value = "Risk Category :  "+emotion.risk.name;
                      // $( risk_value ).appendTo( "#risk_value" );
                      $("#risk_value").text(risk_value);
                      var ctx = document.getElementById("myChart").getContext('2d');
                      var myChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                          labels: ["score",""],
                          datasets: [{
                            backgroundColor: [
                              "#2ecc71",
                              "white"
                            ],
                            data: [emotion.risk.name ,5-emotion.risk.name ]
                          }]
                        }
                      });
                    });
            }

          
          


        });
      });
    </script>
  <!-- /Flot -->




  <!-- /Doughnut Chart -->

  <!-- bootstrap-daterangepicker -->
  <script>
      $(document).ready(function() {
        
      
      

      });
    </script>
  <!-- /bootstrap-daterangepicker -->

  <!-- gauge.js -->

  <!-- /gauge.js -->

  <!-- d3.js -->

  <!-- d3.js -->
</body>

</html>